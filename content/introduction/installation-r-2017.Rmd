---
title: "Guide d'installation ou de mise à jour de R et RStudio"
author: "Sophie Baillargeon, Université Laval"
date: "2017-01-13"
weight: 2
slug: "installation_r_rstudio"
categories: ["cours_2017-01-16"]
lastmodifierdisplayname : "Sophie Baillargeon"
lastmodifieremail: "sophie.baillargeon@mat.ulaval.ca"
output:
  pdf_document:
    toc: yes
    toc_depth: 3
  blogdown::html_page:
    toc: true
header-includes:
- \usepackage[french]{babel}
- \hypersetup{colorlinks=true, urlcolor = {blue}, linkcolor = {blue}}
---

***

<!---
Voici quelques conseils d'installation ou de mise à jour de R.
-->

## Notes préliminaires

### Système d'exploitation

Ce guide explique les étapes générales d'installation de [R](http://www.r-project.org/) et [RSutdio](http://www.rstudio.com/) pour tous les systèmes d'exploitation. Cependant, des explications détaillées sont fournies uniquement pour le système d'exploitation Windows. Plus de détails d'installation pour les utilisateurs Unix/Linux ou Mac OS X sont donnés dans les références suivantes&nbsp;:

- http://cran.r-project.org/doc/FAQ/R-FAQ.html#How-can-R-be-installed_003f      
(documentation officielle du *R core team* concernant l'installation de R);
- http://socserv.mcmaster.ca/jfox/Courses/R/ICPSR/R-install-instructions.html  
(autre bonne source d'information sur l'installation de R, RStudio et de tout le nécessaire à la construction de packages R par John Fox).  

<!---
Sous Windows
En démarrant des programmes (.exe) sous certaines versions de Windows, notamment la version 7, Windows pose des questions de sécurité du genre «&nbsp;Voulez-vous autoriser le programme suivant provenant d'un éditeur inconnu à apporter des modifications à cet ordinateur ?&nbsp;» ou  «&nbsp;L'éditeur n'a pas pu être vérifié. Voulez-vous vraiment exécuter ce logiciel ?&nbsp;». Vous n'avez qu'à donner votre autorisation. Vous connaissez la provenance des .exe que vous tentez d'exécuter et vous savez qu'il ne s'agit pas de logiciels malveillants.
-->


### Nécessaire au développement de packages R

Afin de développer des packages R, quelques outils supplémentaires sont nécessaires. Sous Windows, tous ces outils sont réunis dans les [Rtools](http://cran.r-project.org/bin/windows/Rtools/), qui sont gratuitement distribués sur internet. Ce document explique comment installer les Rtools.

Une des commandes R pour le développement de packages, soit `R CMD check`, a besoin d'une installation de LaTeX pour tester la création de la documentation PDF des packages. Pour développer des packages, vous avez donc le choix entre&nbsp;:

- installer LaTeX sur votre ordinateur (une version gratuite pour Windows est MiKTeX&nbsp;: http://miktex.org/download);
- omettre la création de la documentation PDF lors du la soumission de la commande `R CMD check` grâce à l'option `--no-manual` (on verra plus loin comment faire ça).


***

## Installation de R

R devrait être installé en premier, avant d'installer RStudio. Ainsi, on ne devrait pas avoir besoin d'indiquer à RStudio où est R. Il devrait le trouver par lui-même lors de son installation.

### Lors d'une mise à jour

Si une version antérieure de R est déjà installée sur votre ordinateur, il est conseillé de d'abord la désinstaller avant de procéder à l'installation de la nouvelle version. Ainsi, l'association entre R et l'extension de fichier .Rdata demeurera fonctionnelle.

Cependant, sachez que plusieurs versions de R peuvent être installées simultanément sur votre ordinateur. Par défaut, chaque version de R est installée dans un sous-dossier portant le numéro de la version. Avoir plus d'une version de R est utile, par exemple, lorsqu'un package que l'on utilise ne fonctionne pas avec la version la plus à jour de R.


#### Sous Windows

Pour désinstaller un logiciel sous Windows, une façon simple de procéder est la suivante&nbsp;:

- allez dans «&nbsp;Panneau de configuration > Programmes et fonctionnalités&nbsp;» (ou l'équivalent selon votre version de Windows);
- sélectionnez «&nbsp;R for Windows x.x.x&nbsp;» où x.x.x est le numéro de la version de R à désinstaller;
- cliquez sur «&nbsp;Désinstaller&nbsp;» dans la barre au-dessus de la liste des programmes.

Vous pouvez aussi aller dans les fichiers d'installation de R (par défaut `"C:/Programmes/R/R-x.x.x"`) et double-cliquer sur unins000.exe.

La désinstallation démarrera.


#### Comment savoir qu'une nouvelle version de R est disponible?

Vous pouvez visiter souvent le site web de R. On doit s'attendre à entre 4 et 6 mises à jour par année. Cependant, il est encore plus simple de s'abonner à la liste courriel R-announce (https://stat.ethz.ch/mailman/listinfo/r-announce). Les abonnés reçoivent un courriel lors de la mise en ligne d'une nouvelle version de R.


### Procédure d'installation

Vous pouvez télécharger la version la plus à jour de R comme suit&nbsp;:

- allez sur le site http://www.r-project.org/;
- cliquez sur «&nbsp;CRAN&nbsp;» dans le menu à gauche;
- sélectionnez le site miroir du CRAN le plus près de chez vous;
- dans la case intitulée «&nbsp;Download and Install R&nbsp;», cliquez sur le lien correspondant à votre système d'exploitation.

#### Sous Windows

Cliquez ensuite sur «&nbsp;base&nbsp;», puis sur «&nbsp;Download R y.y.y for Windows&nbsp;» où y.y.y est le numéro de la version la plus à jour de R. Le téléchargement du fichier «&nbsp;R-y.y.y-win.exe&nbsp;» débutera. Il s'agit d'un installateur, soit un programme permettant d'installer R. Il vous suffit ensuite de double-cliquer sur ce fichier et l'installation débutera. *Vous pouvez accepter toutes les options par défaut offertes par l'installateur.*

<!---
Détails des informations que l'installateur vous demande avant de procéder à l'installation (pour R version 3.0.2)&nbsp;:

* choix de la langue pour le programme d'installation;
* acceptation de la licence;
* choix de l'emplacement de R&nbsp;: par défaut il vous propose `"C:\Program Files\R\R-y.y.y"`;
* choix des composantes à installer&nbsp;: installation complète par défaut;
* choix des options de démarrage&nbsp;: interface MDI par défaut plutôt que SDI, format de l'aide HTML par défaut plutôt que texte, accès à internet standard par défaut plutôt qu'avec Internet2 (emploi les paramètres proxy d'Internet Explorer);
* choix de l'emplacement des raccourcis dans le menu démarrer&nbsp;: par défaut dans un dossier nommé R;
* choix concernant les tâches supplémentaires&nbsp;:
  + créer une icône sur le bureau (oui par défaut);
  + créer une icône dans la barre de lancement rapide (non par défaut);
  + enregistrer le numéro de version dans le registre (oui par défaut);
  + associer R avec les fichiers .Rdata (oui par défaut).
-->

***


## Installation de RStudio

Vous pouvez télécharger la version la plus à jour de RStudio Desktop (Open Source License) sur le site web&nbsp;:  

http://www.rstudio.com/products/rstudio/download/

Dans la liste intitulée «&nbsp;Installers for Supported Platforms&nbsp;», cliquez sur le lien correspondant à votre système d'exploitation. Le téléchargement de l'installateur débutera. 

#### Sous Windows

Il vous suffit ensuite de double-cliquer sur le fichier téléchargé et de répondre aux quelques questions. Encore une fois, *vous pouvez accepter toutes les options par défaut offertes par l'installateur*.

#### Modification des configurations de RStudio sous Windows

Une fois RStudio installé, vous désirerez peut-être modifier les configurations de RStudio. Sous Windows, on peut modifier ces configurations par le menu «&nbsp;Tools > Global Options...&nbsp;». Par exemple, il peut être intéressant de&nbsp;:

- dans «&nbsp;General&nbsp;», sélectionner «&nbsp;Never&nbsp;» pour l'option «&nbsp;Save workspace to .RData on exit&nbsp;»; 
- dans «&nbsp;Code > Display&nbsp;», cocher «&nbsp;Show line numbers&nbsp;»;
- autres selon vos goûts.

<!---
Aussi, si l'installateur de RStudio n'a pas créé de raccourci sur le bureau, il peut être pratique de s'en créer un. Si vous ne savez pas comment faire, voici un lien qui l'explique&nbsp;: http://support.microsoft.com/kb/140443/fr.

Finalement, on peut vouloir associer RStudio à certaines extensions de fichiers autres que .R, par exemple les fichiers .Rnw. Ainsi, en double-cliquant sur un fichier portant une de ces extensions, il est automatiquement ouvert en RStudio. Si vous ne savez pas comment modifier les associations entre les programmes et les extensions de fichiers, voici un lien qui l'explique&nbsp;: http://support.microsoft.com/kb/307859/fr .
-->

### Mise à jour de RStudio

Pour mettre à jour RStudio, il est inutile de désinstaller l'ancienne version comme il est conseillé de le faire pour R. Cette différence vient du fait que la nouvelle version de RStudio porte exactement le même nom que l'ancienne (il n'y a pas de numéro de version dans son nom) et elle est, par défaut, installée exactement dans le même emplacement que l'ancienne version. Les anciens fichiers sont donc remplacés par les nouveaux.

On peut vérifier si une nouvelle version de RStudio est disponible par le menu «&nbsp;Help > Check for Updates&nbsp;». Si une nouvelle version est disponible, il suffit de télécharger l'installateur et de l'exécuter, comme pour une première installation.

Vos configurations de RStudio ne seront pas perdues lors d'une mise à jour.

***


## Installation de packages R

Pour installer un nouveau package à partir du CRAN, il suffit de lancer la commande&nbsp;:

```{r, eval=FALSE}
install.packages("nomPkg")
```

Si on souhaite plutôt installer un package à partir d'un fichier sur notre ordinateur (.zip si on est sur Windows), il faut plutôt lancer la commande&nbsp;:

```{r, eval=FALSE}
install.packages("cheminAcces/nomPkg_NoVersion.zip", repos = NULL)
```

En RStudio, on peut lancer la commande install.packages par le menu «&nbsp;Packages > Install Packages&nbsp;», en sélectionnant les options appropriées.

Le répertoire dans lequel les packages R sont installés par défaut est identifé dans le premier élément du vecteur retourné par la commande R suivante&nbsp;:

```{r, eval=FALSE}
.libPaths()
```


### Anciens packages et mise à jour de R

Si vous aviez déjà une version de R sur votre ordinateur et que vous avez mis R à jour, il est possible que vous n'ayez plus accès, avec le nouveau R, aux packages que vous aviez installés avec une version antérieure de R. Vous pouvez régler ce problème en&nbsp;:

- réinstallant tous les packages dont vous avez besoin avec la nouvelle version de R, du coup les packages sont mis à jour;
- copiant les fichiers d'installation de ces packages dans le nouveau dossier d'installation de packages (par exemple, sous Windows, on copie les fichiers restants dans `"C:\Program Files\R\R-x.x.x\library"` ou `"C:\Users\nomUsager\Documents\R\win-library\x.x"` après la désinstallation de la version x.x.x et on colle le tout dans le dossier équivalent pour la nouvelle version, soit `"C:\Program Files\R\R-y.y.y\library"` ou `"C:\Users\nomUsager\Documents\R\win-library\y.y"`).



### Mise à jour des packages

N'oubliez pas que les packages R peuvent eux aussi avoir été mis à jour depuis que vous les avez téléchargés. Pour avoir accès aux dernières corrections et aux derniers ajouts de fonctionnalités des packages que vous utilisez, il est conseillé de vérifier fréquemment si de nouvelles versions sont disponibles et de les installer si c'est le cas.

En RStudio, on peut facilement vérifier si des mises à jour de packages sont disponibles par le menu «&nbsp;Packages > Update&nbsp;».

***


## Installation des Rtools (pour Windows)

Vous pouvez vous rendre sur le site de téléchargement des Rtools comme suit&nbsp;:

- allez sur le site http://www.r-project.org/;
- cliquez sur «&nbsp;CRAN&nbsp;» dans le menu à gauche;
- sélectionnez le site miroir du CRAN le plus près de chez vous;
- dans la case intitulée «&nbsp;Download and Install R&nbsp;», cliquez sur «&nbsp;Download R for Windows&nbsp;»;
- cliquez sur «&nbsp;Rtools&nbsp;».

Ensuite, téléchargez la version la plus à jour qui est compatible avec la version de R installée sur votre ordinateur. Si votre R est à jour, il s'agit de la version dans la première case de la colonne «&nbsp;Download&nbsp;» du tableau. Typiquement, pour cette version, la colonne «&nbsp;Frozen&nbsp;» indique «&nbsp;No&nbsp;». Ce n'est pas un problème.

En cliquant sur le lien, le téléchargement de l'installateur débutera. Il vous suffit ensuite de double-cliquer sur le fichier téléchargé et l'installation débutera. Encore une fois, *vous pouvez accepter toutes les options par défaut offertes par l'installateur*.


### Mise à jour des Rtools

Les Rtools sont mis à jour périodiquement. Je vous conseille de vérifier si une nouvelle version des Rtools est disponible à chaque fois que vous mettez R à jour. Pour ce faire, il faut&nbsp;:

- se rendre sur le site web de téléchargement des Rtools;
- vérifier le numéro de la version courante des Rtools en cliquant sur le lien «&nbsp;VERSION.txt&nbsp;» au-dessus du tableau de téléchargement;
- comparer ce numéro au numéro de la version installée sur votre ordinateur, que l'on retrouve dans le dossier d'installation des Rtools (par défaut `"C:\Rtools\VERSION.txt"`);
- si la version sur votre ordinateur est antérieure à la version disponible sur internet, mettre les Rtools à jour.

Comme pour R, il est conseillé de désinstaller les Rtools avant d'en installer une nouvelle version (des indications pour la désinstallation de programmes sous Windows sont fournies plus haut).


***

## Résolution de problèmes

En principe, tout devrait fonctionner correctement en suivant ces procédures d'installation. Cependant, un problème est si vite arrivé en informatique. Voici comment régler certains problèmes techniques déjà rencontrés.


#### Les accents s'affichent incorrectement dans RStudio.

RStudio suppose un certain encodage lors de l'ouverture d'un fichier, par exemple d'un programme (aussi nommé script) R. Pour connaître l'encodage supposé par votre installation de RStudio, allez dans le menu «&nbsp;Tools > Global Options... > Code > Saving&nbsp;». On peut lire dans le champ «&nbsp;Default text encoding:&nbsp;» l'encodage par défaut. Les programmes R que vous téléchargerez sur le site web du cours seront toujours en encodage UTF-8.

Pour corriger l'affichage des accents dans un fichier en RStudio, vous pouvez&nbsp;:

- soit rouvrir le fichier avec le bon encodage par le menu «&nbsp;File > Reopen with Encoding...&nbsp;» (et sélectionner «&nbsp;UTF-8&nbsp;» s'il s'agit d'un de mes fichiers),
- soit modifier la configuration de votre installation de RStudio pour utiliser par défaut l'encodage du fichier. Cette reconfiguration peut se faire par menu «&nbsp;File > Reopen with Encoding...&nbsp;» en sélectionnant l'encodage voulu, puis en cochant «&nbsp;Set as default encoding for source files&nbsp;», ou encore par le menu «&nbsp;Tools > Global Options... > Code > Saving&nbsp;».


#### RStudio ne trouve pas les Rtools alors qu'il sont bel et bien installés sur mon ordinateur.

Dans ce cas, une solution sous Windows est de modifier le PATH de votre ordinateur. Le PATH est une variable d'environnement du système qui indique à l'ordinateur dans quels dossiers rechercher les programmes exécutables. L'installateur de Rtools peut modifier le PATH pour vous. Vous pouvez donc désinstaller les Rtools, puis les réinstaller en sélectionnant l'option de modifier le PATH offerte par l'installateur, mais non sélectionnée par défaut.


#### Je n'arrive pas à installer des packages, car on me dit que je n'ai pas la permission de modifier le contenu du dossier où les packages doivent être installés.

Il existe plusieurs solutions à ce problème. La plus simple est certainement d'installer R dans un emplacement où vous avez la permission de modifier le contenu selon les privilèges associés à votre compte sur votre ordinateur. Sur Windows, installer R dans `"C:\R"` au lieu de l'emplacement par défaut `"C:\Program Files\R"` règle habituellement le problème. Pour ce faire, commencez par désinstaller R, puis réinstallez-le en changeant l'emplacement que vous propose l'installateur.


#### L'explorateur de fichiers Windows n'affiche pas les extensions de certains fichiers.

Ce problème n'est pas en lien avec l'installation de R ou RStudio, mais on me questionne souvent à ce propos. Par défaut, Windows n'affiche pas les extensions des fichiers dont le type a été associé à un programme. Voici comment changer cette option avec Windows 7. 

Il faut d'abord ouvrir la fenêtre d'«&nbsp;Options des dossiers&nbsp;»&nbsp;:

- soit dans un explorateur Windows, par le menu «&nbsp;Organiser -> Options des dossiers et de recherche&nbsp;», 
- soit par «&nbsp;Panneau de configuration -> Options de dossiers&nbsp;». 

Ensuite, sous l'onglet Affichage, décochez l'option «&nbsp;Masquer les extensions des fichiers dont le type est connu&nbsp;».

